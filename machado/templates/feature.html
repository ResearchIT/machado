<!--
 Copyright 2018 by Embrapa.  All rights reserved.

 This code is part of the machado distribution and governed by its
 license. Please see the LICENSE.txt and README.md files that should
 have been included as part of this package for licensing information.
-->
{% extends 'base.html' %}

{% block content %}


{% if feature.error == None %}

  {% if data %}
  <div class="card m-1">
    <div class="card-header">
        <small><i>{{ feature.organism.genus }} {{ feature.organism.species }}</i></small>
        <h2 class="card-title">{{ feature.type.name }}: {{ feature.name }}</h2>
    </div>
    <div class="card-body">
      <div class="card-text">
      <p>ID: {{ feature.uniquename }}</p>
      {% if feature.get_display %}<p>Display: {{ feature.get_display }}</p>{% endif %}
      {% if feature.get_description %}<p>Description: {{ feature.get_description }}</p>{% endif %}
      {% if feature.get_note %}<p>Note: {{ feature.get_note }}</p>{% endif %}
      {% if data.relationship %}
        <p>
        {% for relative in data.relationship %}
        {{ relative.type.name }}: <a href="{% url 'feature'%}?feature_id={{ relative.feature_id|safe }}">{{ relative.uniquename }}</a> {{ relative.get_display|default_if_none:'' }}<br />
        {% endfor %}
        </p>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif%}

  {% if data.location %}
  <div class="card m-1">
    <div class="card-header">
        <h3 class="card-title">Location</h3>
    </div>
    <div class="card-body">
      <div class="card-text">
        {% for location in data.location %}
        <p>{{ location.ref|safe }}:{{ location.start|safe }}..{{ location.end|safe }} {{ location.strand|safe }}</p>
          {% if location.jbrowse_url %}
            <iframe style='border:0' width='100%' height='300' src="{{ location.jbrowse_url }}"></iframe>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

  {% if data.cvterm or data.protein_matches %}
  <div class="card m-1">
    <div class="card-header">
      <h3 class="card-title">Functional annotation</h3>
    </div>
    <div class="card-body">
      <div class="card-text">
        {% if data.cvterm %}
        <table class="table table-sm table-hover">
          <thead>
            <tr>
              <th scope="col">Ontology</th>
              <th scope="col">ID</th>
              <th scope="col">Term</th>
            </tr>
          </thead>
          <tbody>
          {% for cvterm in data.cvterm %}
            <tr>
              <td>{{ cvterm.cv|safe }}</td>
              <td>{{ cvterm.db }}:{{ cvterm.dbxref }}</td>
              <td>{{ cvterm.cvterm|safe }}
            </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
        {% endif %}

        {% if data.protein_matches %}
        <table class="table table-sm table-hover">
          <thead>
            <tr>
              <th scope="col">Protein database</th>
              <th scope="col">Protein domain</th>
            </tr>
          </thead>
          <tbody>
          {% for domain in data.protein_matches %}
            <tr>
              <td>{{ domain.db|safe }}</td>
              <td>{{ domain.subject_id|safe }} {{ domain.subject_desc|default_if_none:'' }}
            </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
        {% endif %}


      </div>
    </div>
  </div>
  {% endif %}

  {% if data.similarity %}
  <div class="card m-1">
    <div class="card-header">
      <h3 class="card-title">Similarity</h3>
    </div>
    <div class="card-body">
      <div class="card-text">
        <table class="table table-sm table-hover">
          <thead>
            <tr>
              <th scope="col">Program</th>
              <th scope="col">Hit</th>
              <th scope="col">Query start</th>
              <th scope="col">Query end</th>
              <th scope="col">Score</th>
              <th scope="col">Evalue</th>
            </tr>
          </thead>
          <tbody>
          {% for hit in data.similarity %}
            <tr>
              <td>{{ hit.program|safe }} {{ hit.programversion|safe }}</td>
              <td>{{ hit.db_name|default_if_none:'' }} {{ hit.uniquename|safe }} {{ hit.name|safe }} {{ hit.display|default_if_none:'' }}</td>
              <td>{{ hit.query_start|default_if_none:''|safe }}</td>
              <td>{{ hit.query_end|default_if_none:''|safe }}</td>
              <td>{{ hit.score|default_if_none:''|safe }}</td>
              <td>{{ hit.evalue|default_if_none:''|safe }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
    </div>
  </div>
  {% endif %}

  {% if data.orthologs %}
  <div class="card m-1">
    <div class="card-header">
        <h3 class="card-title">Orthologs</h3>
    </div>
    <div class="card-body">
      <div class="card-text">
        {% for group_id, group in data.orthologs.items %}
            <ul class="list-group list-group-flush">
            <li class="list-group-item list-group-item-secondary"><a href="{% url 'feature_search' %}?q={{ group_id }}">{{ group_id }}</a></li>
            {% for ortholog in group  %}
            <li class="list-group-item">{{ ortholog.type.name }}: <a href="{% url 'feature'%}?feature_id={{ ortholog.feature_id|safe }}">{{ ortholog.uniquename }}</a> {{ ortholog.get_display|default_if_none:'' }} (<i>{{ ortholog.organism.genus }} {{ ortholog.organism.species }}</i>)</li>
            {% endfor %}
            </ul>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

  {% if feature.residues %}
  <div class="card m-1">
    <div class="card-header">
        <h3 class="card-title">Sequence</h3>
    </div>
    <div class="card-body">
      <div class="card-text text-monospace">
          <small>{{ feature.residues}}</small>
      </div>
    </div>
  </div>
  {% endif %}

  {% if data.pubs %}
  <div class="card m-1">
    <div class="card-header">
        <h3 class="card-title">Publications</h3>
    </div>
    <div class="card-body">
      <div class="card-text">
        <ul class="list-group">
        {% for pub in data.pubs %}
            <li class="list-group-item"><small>
                    {{ pub.get_authors }} <b>{{ pub.title }}.</b> <i>{{ pub.series_name }}</i>. {{ pub.pyear }}; {{ pub.volume}} {{ pub.pages }}
                    {% if pub.get_doi %}
                    DOI:<a target="_blank" href="http://dx.doi.org/{{ pub.get_doi }}">{{ pub.get_doi }}</a>
                    {% endif %}
            </small></li>
        {% endfor %}
        </ul>
      </div>
    </div>
  </div>
  {% endif %}


{% else %}
  {{ feature.error }}
{% endif %}

{% endblock %}
